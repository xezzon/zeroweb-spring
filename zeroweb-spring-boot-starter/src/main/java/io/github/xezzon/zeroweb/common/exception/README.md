# 错误码分配中心

## 错误码规则

ZeroWeb 设计的错误码为 5 位，格式如`CFF01`。

第 1 位表示类型。例如 `S`表示服务端异常，`C`表示客户端输入错误。

第 2~3 位是一个 2 位的十六进制数，表示模块编码。
`0`是所有模块共有的错误码；ZeroWeb 的模块从 `-1`~`-128` 依次编号，然后转换为十六进制数 `FF`~`80`；
业务模块从 `1`~`127` 依次编号，然后转换为十六进制数 `01`~`7F`。

第 4~5 位是模块内的错误编号，由各模块自行编号。
ZeroWeb 的编号规则是从 `1`~`255` 依次编号，并转换为十六进制数 `00`~`FF`。

## 异常处理

### 异常类型

异常可分为系统异常（可进一步细分为第一方应用异常、第三方应用异常等）、业务异常。
前者通常是由代码、配置等错误引起的，这需要开发或运维人员进行处理，从而不需要向客户端提供异常的细节；
后者则通常与用户的输入有关，需要向客户端返回错误原因、建议的处理方式等细节。

从产生源头的角度，也可以分为自发异常和框架异常。
前者由开发人员自行定义；后者则由 JDK 或第三方类库抛出。

### `异常类-错误码`映射

- 自发业务异常，继承 `io.github.xezzon.zeroweb.common.exception.ZerowebBussinessException`，并定义对应的错误码。
- 自发系统异常，继承 `io.github.xezzon.zeroweb.common.exception.ZerowebRuntimeException`
  。由映射表映射到对应的错误码。
- 框架业务异常、框架系统异常。均由映射表映射到对应的错误码。

### 日志

Slf4j 会记录 `Throwable#getMessage()` 的内容。
所以有条件的情况下，应以系统语言对异常类进行国际化，覆盖 `Throwable#getMessage()`方法。

### 返回值

发生异常时，返回值应该包含`错误码`、`异常名称`、`异常消息`（以请求的语言 Accept-Language 进行国际化）。
可选包含`错误明细`（当错误由多个原因引起）。
请求头中，应该赋值`HTTP响应状态码`、`错误码`。
